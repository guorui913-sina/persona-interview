<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆé•¿å‘¨æŠ¥ - ç¬¬1å‘¨ (2026-02-02 è‡³ 2026-02-08)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600;700&family=Fira+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Fira Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #F8FAFC;
            color: #1E293B;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: #FFFFFF;
            padding: 32px;
            border-radius: 12px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .title {
            font-size: 28px;
            font-weight:  700;
            color: #1E3A8A;
        }

        .refresh-btn {
            padding: 8px 16px;
            background: #3B82F6;
            color: #FFFFFF;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .refresh-btn:hover {
            background: #2563EB;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: #FFFFFF;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .stat-label {
            font-size: 14px;
            color: #64748B;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            font-family: 'Fira Code', monospace;
            color: #1E40AF;
        }

        /* Actions Bar */
        .actions-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding: 16px;
            background: #FFFFFF;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .filter-tabs {
            display: flex;
            gap: 8px;
        }

        .filter-tab {
            padding: 8px 16px;
            background: #F1F5F9;
            color: #64748B;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-tab:hover {
            background: #E2E8F0;
        }

        .filter-tab.active {
            background: #3B82F6;
            color: #FFFFFF;
        }

        .create-btn {
            padding: 10px 20px;
            background: #22C55E;
            color: #FFFFFF;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .create-btn:hover {
            background: #16A34A;
        }

        /* Decision List */
        .decision-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .decision-card {
            background: #FFFFFF;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }

        .decision-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .decision-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
        }

        .decision-title {
            font-size: 18px;
            font-weight: 600;
            color: #1E293B;
            flex: 1;
        }

        .decision-meta {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .decision-id {
            font-size: 11px;
            font-family: 'Fira Code', monospace;
            color: #94A3B8;
            background: #F1F5F9;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .decision-type {
            font-size: 12px;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 6px;
        }

        .decision-type.life {
            background: #FEE2E2;
            color: #991B1B;
        }

        .decision-type.important {
            background: #FEF3C7;
            color: #92400E;
        }

        .decision-type.daily {
            background: #DCFCE7;
            color: #166534;
        }

        .risk-badge {
            font-size: 14px;
        }

        /* Decision Details */
        .decision-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }

        .detail-item {
            font-size: 13px;
            color: #64748B;
        }

        .detail-item strong {
            color: #475569;
            font-weight: 600;
        }

        /* Emotion Bar */
        .emotion-section {
            margin: 12px 0;
        }

        .emotion-label {
            font-size: 12px;
            color: #64748B;
            margin-bottom: 4px;
        }

        .emotion-track {
            height: 6px;
            background: #E5E7EB;
            border-radius: 3px;
            overflow: hidden;
        }

        .emotion-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .emotion-fill.low { background: #22C55E; }
        .emotion-fill.medium { background: #F59E0B; }
        .emotion-fill.high { background: #EF4444; }

        /* Status Section */
        .status-section {
            padding-top: 16px;
            border-top: 1px solid #F1F5F9;
        }

        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .current-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-badge {
            font-size: 12px;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 6px;
        }

        .status-badge.pending { background: #F1F5F9; color: #64748B; }
        .status-badge.in_progress { background: #DBEAFE; color: #1E40AF; }
        .status-badge.accepted { background: #DCFCE7; color: #166534; }
        .status-badge.rejected { background: #FEE2E2; color: #991B1B; }
        .status-badge.completed { background: #D1FAE5; color: #065F46; }

        .status-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .action-btn {
            font-size: 12px;
            font-weight: 500;
            padding: 6px 12px;
            border-radius: 6px;
            border: 1px solid #E5E7EB;
            background: #FFFFFF;
            color: #475569;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .action-btn:hover:not(:disabled) {
            background: #F8FAFC;
            border-color: #CBD5E1;
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Progress */
        .progress-section {
            margin-top: 12px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #64748B;
            margin-bottom: 4px;
        }

        .progress-track {
            height: 8px;
            background: #E5E7EB;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3B82F6 0%, #8B5CF6 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* Required Actions */
        .required-actions {
            margin-top: 12px;
            padding: 12px;
            background: #FFFBEB;
            border: 1px solid #F59E0B;
            border-radius: 8px;
        }

        .actions-title {
            font-size: 13px;
            font-weight: 600;
            color: #92400E;
            margin-bottom: 8px;
        }

        .actions-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .action-item {
            display: flex;
            align-items: start;
            gap: 8px;
            font-size: 13px;
            color: #78350F;
            margin-bottom: 4px;
        }

        .action-checkbox {
            width: 16px;
            height: 16px;
            border: 2px solid #F59E0B;
            border-radius: 4px;
            flex-shrink: 0;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .action-checkbox.checked {
            background: #F59E0B;
            position: relative;
        }

        .action-checkbox.checked::after {
            content: 'âœ“';
            position: absolute;
            color: #FFFFFF;
            font-size: 12px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #FFFFFF;
            border-radius: 12px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 18px;
            font-weight: 600;
            color: #1E293B;
            margin-bottom: 16px;
        }

        .modal-body {
            margin-bottom: 16px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 4px;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
            font-family: 'Fira Sans', sans-serif;
            font-size: 14px;
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: 1px solid #E5E7EB;
            background: #FFFFFF;
            color: #475569;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }

        .modal-btn.primary {
            background: #3B82F6;
            color: #FFFFFF;
            border-color: #3B82F6;
        }

        /* Details Modal */
        #detailsModal .modal-content {
            max-height: 85vh;
            overflow-y: auto;
        }

        #details-content {
            /* Remove inner scroll to avoid nested scrollbars */
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #64748B;
        }

        .error {
            background: #FEE2E2;
            color: #991B1B;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #94A3B8;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .actions-bar {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }

            .filter-tabs {
                overflow-x: auto;
            }

            .decision-header {
                flex-direction: column;
                gap: 12px;
            }

            .decision-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-top">
                <div>
                    <div style="font-size: 14px; font-weight: 600; color: #64748B; margin-bottom: 8px;">æˆé•¿å‘¨æŠ¥ - ç¬¬1å‘¨</div>
                    <h1 class="title" style="margin-bottom: 8px;">2026-02-02 è‡³ 2026-02-08</h1>
                    <div style="width: 60px; height: 4px; background: #3B82F6; border-radius: 2px;"></div>
                </div>
                <div style="display: flex; gap: 8px;">
                    <button class="refresh-btn" style="background: #22C55E;" onclick="exportReport()">ğŸ“¥ å¯¼å‡ºå‘¨æŠ¥</button>
                    <button class="refresh-btn" onclick="loadData()">ğŸ”„ åˆ·æ–°</button>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid" id="stats-grid">
            <div class="stat-card">
                <div class="stat-label">æ€»å†³ç­–æ•°</div>
                <div class="stat-value" id="stat-total">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">è¿›è¡Œä¸­</div>
                <div class="stat-value" id="stat-in-progress" style="color: #F59E0B">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">å·²å®Œæˆ</div>
                <div class="stat-value" id="stat-completed" style="color: #22C55E">-</div>
            </div>
        </div>

        <!-- Actions Bar -->
        <div class="actions-bar">
            <div class="filter-tabs">
                <button class="filter-tab active" onclick="filterDecisions('all')">å…¨éƒ¨</button>
                <button class="filter-tab" onclick="filterDecisions('pending')">â³ å¾…å¤„ç†</button>
                <button class="filter-tab" onclick="filterDecisions('in_progress')">ğŸ”„ è¿›è¡Œä¸­</button>
                <button class="filter-tab" onclick="filterDecisions('accepted')">âœ… å·²é‡‡çº³</button>
                <button class="filter-tab" onclick="filterDecisions('rejected')">âŒ å·²æ‹’ç»</button>
                <button class="filter-tab" onclick="filterDecisions('completed')">ğŸ å·²å®Œæˆ</button>
            </div>
            <button class="create-btn" onclick="openCreateModal()">+ æ–°å»ºå†³ç­–</button>
        </div>

        <!-- Decision List -->
        <div id="decision-list" class="decision-list">
            <div class="loading">åŠ è½½ä¸­...</div>
        </div>

        <!-- Behavior Analysis Section -->
        <div class="section" style="margin-top: 32px;">
            <h2 style="font-size: 20px; font-weight: 700; color: #1E40AF; margin-bottom: 16px;">ğŸ” è¡Œä¸ºæ¨¡å¼åˆ†æ</h2>
            <div id="behavior-analysis" style="background: #F1F5F9; padding: 16px; border-radius: 8px; color: #475569;">
                åŠ è½½ä¸­...
            </div>
        </div>

        <!-- Metrics Table Section -->
        <div class="section" style="margin-top: 32px;">
            <h2 style="font-size: 20px; font-weight: 700; color: #1E40AF; margin-bottom: 16px;">ğŸ“ˆ æŒ‡æ ‡è¿½è¸ª</h2>
            <div style="background: #FFFFFF; border-radius: 12px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); overflow: hidden;">
                <div style="display: grid; grid-template-columns: 2fr 1fr 2fr; gap: 16px; padding: 16px; background: #F8FAFC; font-weight: 600; color: #475569; border-bottom: 1px solid #E2E8F0;">
                    <div>æŒ‡æ ‡</div>
                    <div>æœ¬å‘¨</div>
                    <div>è¯´æ˜</div>
                </div>
                <div id="metrics-content">
                    <!-- Metrics will be loaded dynamically -->
                </div>
            </div>
        </div>

        <!-- Suggestions Section -->
        <div class="section" style="margin-top: 32px; margin-bottom: 32px;">
            <h2 style="font-size: 20px; font-weight: 700; color: #1E40AF; margin-bottom: 16px;">ğŸ’¡ ä¸‹å‘¨å»ºè®®</h2>
            <div id="suggestions" style="background: #FEF3C7; padding: 16px; border-radius: 8px; border-left: 4px solid #F59E0B; color: #92400E;">
                åŠ è½½ä¸­...
            </div>
        </div>
    </div>

    <!-- Create Decision Modal -->
    <div class="modal" id="createModal">
        <div class="modal-content">
            <div class="modal-header">æ–°å»ºå†³ç­–</div>
            <div class="modal-body">
                <form id="createForm">
                    <div class="form-group">
                        <label class="form-label">å†³ç­–æè¿° *</label>
                        <input type="text" class="form-input" id="create-description" required placeholder="ä¾‹å¦‚ï¼šè€ƒè™‘åœ¨åŒ—äº¬ä¹°æˆ¿">
                    </div>

                    <div class="form-group">
                        <label class="form-label">å†³ç­–ç±»å‹ *</label>
                        <select class="form-select" id="create-type" required>
                            <option value="daily">æ—¥å¸¸å†³ç­–</option>
                            <option value="important">é‡è¦å†³ç­–</option>
                            <option value="life_level">ç”Ÿå‘½çº§å†³ç­–</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ç†æ€§åˆ†æ</label>
                        <textarea class="form-textarea" id="create-rational" placeholder="ç†æ€§åˆ†æ..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">æƒ…æ„Ÿå› ç´ ï¼ˆé€—å·åˆ†éš”ï¼‰</label>
                        <input type="text" class="form-input" id="create-emotions" placeholder="ä¾‹å¦‚ï¼šç»“å©šéœ€æ±‚, çˆ¶æ¯æœŸå¾…">
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button class="modal-btn" onclick="closeCreateModal()">å–æ¶ˆ</button>
                <button class="modal-btn primary" onclick="createDecision()">åˆ›å»º</button>
            </div>
        </div>
    </div>

    <!-- Update Status Modal -->
    <div class="modal" id="updateModal">
        <div class="modal-content">
            <div class="modal-header">æ›´æ–°å†³ç­–çŠ¶æ€</div>
            <div class="modal-body">
                <form id="updateForm">
                    <input type="hidden" id="update-decision-id">

                    <div class="form-group">
                        <label class="form-label">å½“å‰çŠ¶æ€</label>
                        <div class="status-badge" id="current-status-badge" style="display: inline-block;">-</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">æ–°çŠ¶æ€ *</label>
                        <select class="form-select" id="update-status" required>
                            <option value="pending">â³ å¾…å¤„ç†</option>
                            <option value="in_progress">ğŸ”„ è¿›è¡Œä¸­</option>
                            <option value="accepted">âœ… å·²é‡‡çº³</option>
                            <option value="rejected">âŒ å·²æ‹’ç»</option>
                            <option value="completed">ğŸ å·²å®Œæˆ</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">å¤‡æ³¨</label>
                        <textarea class="form-textarea" id="update-note" placeholder="è®°å½•åŸå› æˆ–æƒ³æ³•..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button class="modal-btn" onclick="closeUpdateModal()">å–æ¶ˆ</button>
                <button class="modal-btn primary" onclick="updateStatus()">æ›´æ–°</button>
            </div>
        </div>
    </div>

    <!-- Decision Details Modal -->
    <div class="modal" id="detailsModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">å†³ç­–è¯¦æƒ…</div>
            <div class="modal-body" id="details-content">
                <!-- Details will be loaded here -->
            </div>
            <div class="modal-actions">
                <button class="modal-btn primary" onclick="closeDetailsModal()">å…³é—­</button>
            </div>
        </div>
    </div>

    <script>
        // API Base URL
        const API_BASE = '/api';
        let allDecisions = [];
        let currentFilter = 'all';

        // Load data from API
        async function loadData() {
            try {
                const response = await fetch(`${API_BASE}/decisions`);
                const result = await response.json();

                if (result.success) {
                    allDecisions = result.data;
                    renderDecisions();
                    updateStats();
                    updateMetrics();
                    updateBehaviorAnalysis();
                    updateSuggestions();
                } else {
                    showError('åŠ è½½æ•°æ®å¤±è´¥ï¼š' + result.error);
                }
            } catch (error) {
                showError('ç½‘ç»œé”™è¯¯ï¼š' + error.message);
            }
        }

        // Render decisions
        function renderDecisions() {
            const container = document.getElementById('decision-list');

            const filtered = filterDecisionsData();

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“‹</div>
                        <p>æš‚æ— å†³ç­–è®°å½•</p>
                        <p>ç‚¹å‡»"æ–°å»ºå†³ç­–"å¼€å§‹è¿½è¸ª</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filtered.map(decision => createDecisionCard(decision)).join('');
        }

        // Filter decisions
        function filterDecisionsData() {
            if (currentFilter === 'all') {
                return allDecisions;
            }
            return allDecisions.filter(d => d.outcome === currentFilter);
        }

        function filterDecisions(filter) {
            currentFilter = filter;

            // Update tab styles
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            renderDecisions();
        }

        // Create decision card HTML
        function createDecisionCard(decision) {
            const riskEmojis = {
                high: 'ğŸ”´',
                medium: 'ğŸŸ¡',
                low: 'ğŸŸ¢'
            };

            const typeLabels = {
                life_level: 'ç”Ÿå‘½çº§',
                important: 'é‡è¦',
                daily: 'æ—¥å¸¸'
            };

            const typeClasses = {
                life_level: 'life',
                important: 'important',
                daily: 'daily'
            };

            const statusBadges = {
                pending: '<span class="status-emoji">â³</span>',
                in_progress: '<span class="status-emoji">ğŸ”„</span>',
                accepted: '<span class="status-emoji">âœ…</span>',
                rejected: '<span class="status-emoji">âŒ</span>',
                completed: '<span class="status-emoji">ğŸ</span>'
            };

            const emotionRatio = decision.emotion_ratio || 0;
            const emotionClass = emotionRatio > 0.5 ? 'high' : emotionRatio > 0.2 ? 'medium' : 'low';

            return `
                <div class="decision-card" id="decision-${decision.decision_id}">
                    <div class="decision-header">
                        <div class="decision-title">${decision.description}</div>
                        <div class="decision-meta">
                            <span class="decision-id">${decision.decision_id.substring(0, 12)}</span>
                            <span class="decision-type ${typeClasses[decision.type]}">${typeLabels[decision.type]}</span>
                            <span class="risk-badge">${riskEmojis[decision.risk_level] || 'âšª'} ${decision.risk_level.toUpperCase()}</span>
                        </div>
                    </div>

                    <div class="decision-details">
                        <div class="detail-item">
                            <strong>æ—¶é—´ï¼š</strong>${new Date(decision.timestamp).toLocaleString('zh-CN')}
                        </div>
                        ${decision.rational_analysis ? `
                        <div class="detail-item">
                            <strong>ç†æ€§åˆ†æï¼š</strong>${decision.rational_analysis.substring(0, 50)}...
                        </div>
                        ` : ''}
                    </div>

                    ${decision.emotional_factors && decision.emotional_factors.length > 0 ? `
                    <div class="emotion-section">
                        <div class="emotion-label">æƒ…æ„Ÿå› ç´ ï¼š${emotionRatio*100}% (${decision.emotional_factors.join(', ')})</div>
                        <div class="emotion-track">
                            <div class="emotion-fill ${emotionClass}" style="width: ${emotionRatio*100}%"></div>
                        </div>
                    </div>
                    ` : ''}

                    <div class="status-section">
                        <div class="status-header">
                            <div class="current-status">
                                ${statusBadges[decision.outcome] || ''}
                                <span class="status-badge ${decision.outcome}">${getStatusText(decision.outcome)}</span>
                            </div>
                            <div class="status-actions">
                                ${decision.outcome === 'pending' || decision.outcome === 'in_progress' ? `
                                    <button class="action-btn" onclick="openUpdateModal('${decision.decision_id}', '${decision.outcome}')">æ›´æ–°çŠ¶æ€</button>
                                ` : ''}
                                <button class="action-btn" onclick="viewDetails('${decision.decision_id}')">æŸ¥çœ‹è¯¦æƒ…</button>
                            </div>
                        </div>

                        ${decision.type === 'life_level' && decision.outcome === 'in_progress' ? `
                            <div class="required-actions">
                                <div class="actions-title">ğŸ“‹ å¿…è¦è¡ŒåŠ¨æ¸…å•ï¼ˆç”Ÿå‘½çº§å†³ç­–ï¼‰</div>
                                <ul class="actions-list">
                                    <li class="action-item">
                                        <div class="action-checkbox" onclick="toggleAction(this)"></div>
                                        <span>åˆ—å‡º3ä¸ªä¸åšçš„ç†ç”±</span>
                                    </li>
                                    <li class="action-item">
                                        <div class="action-checkbox" onclick="toggleAction(this)"></div>
                                        <span>æœ€åæƒ…å†µæ¨æ¼”</span>
                                    </li>
                                    <li class="action-item">
                                        <div class="action-checkbox" onclick="toggleAction(this)"></div>
                                        <span>å’¨è¯¢3ä¸ªä¸åŒç«‹åœºçš„äºº</span>
                                    </li>
                                    <li class="action-item">
                                        <div class="action-checkbox" onclick="toggleAction(this)"></div>
                                        <span>7å¤©å†·é™æœŸ</span>
                                    </li>
                                    <li class="action-item">
                                        <div class="action-checkbox" onclick="toggleAction(this)"></div>
                                        <span>æ£€æŸ¥"è´£ä»»"ä¸»é¢˜</span>
                                    </li>
                                </ul>
                                <div class="progress-section">
                                    <div class="progress-label">
                                        <span>å®Œæˆè¿›åº¦</span>
                                        <span class="progress-text">0%</span>
                                    </div>
                                    <div class="progress-track">
                                        <div class="progress-fill" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // Update stats
        function updateStats() {
            const stats = {
                total: allDecisions.length,
                'in-progress': allDecisions.filter(d => d.outcome === 'in_progress').length,
                'completed': allDecisions.filter(d => d.outcome === 'completed').length
            };

            document.getElementById('stat-total').textContent = stats.total;
            document.getElementById('stat-in-progress').textContent = stats['in-progress'];
            document.getElementById('stat-completed').textContent = stats.completed;
        }

        // Update metrics table
        function updateMetrics() {
            const container = document.getElementById('metrics-content');

            // Calculate metrics
            const totalDecisions = allDecisions.length;
            const inProgressCount = allDecisions.filter(d => d.outcome === 'in_progress').length;
            const avgEmotion = allDecisions.length > 0
                ? (allDecisions.reduce((sum, d) => sum + (d.emotion_ratio || 0), 0) / allDecisions.length * 100).toFixed(0)
                : 0;

            const metrics = [
                {
                    name: 'å†³ç­–æ€»æ•°',
                    value: totalDecisions.toString(),
                    desc: 'æœ¬å‘¨è®°å½•çš„å†³ç­–æ•°é‡',
                    color: 'blue'
                },
                {
                    name: 'è¿›è¡Œä¸­å†³ç­–',
                    value: inProgressCount.toString(),
                    desc: 'æ­£åœ¨å¤„ç†çš„å†³ç­–',
                    color: 'orange'
                },
                {
                    name: 'å¹³å‡æƒ…æ„Ÿå æ¯”',
                    value: avgEmotion + '%',
                    desc: 'æ‰€æœ‰å†³ç­–çš„å¹³å‡æƒ…æ„Ÿå› ç´ ',
                    color: 'orange'
                }
            ];

            container.innerHTML = metrics.map(m => `
                <div style="display: grid; grid-template-columns: 2fr 1fr 2fr; gap: 16px; padding: 16px; border-bottom: 1px solid #E2E8F0;">
                    <div style="color: #1E293B;">${m.name}</div>
                    <div style="color: #${m.color === 'blue' ? '1E40AF' : 'F59E0B'}; font-weight: 600;">${m.value}</div>
                    <div style="color: #64748B; font-size: 14px;">${m.desc}</div>
                </div>
            `).join('');
        }

        // Update behavior analysis
        function updateBehaviorAnalysis() {
            const container = document.getElementById('behavior-analysis');
            if (!container) return;

            if (allDecisions.length === 0) {
                container.innerHTML = 'æš‚æ— è¶³å¤Ÿæ•°æ®è¿›è¡Œåˆ†æ';
                return;
            }

            // åˆ†ææ•°æ®
            const analysis = [];

            // 1. å†³ç­–ç±»å‹åˆ†å¸ƒ
            const typeDist = {};
            allDecisions.forEach(d => {
                typeDist[d.type] = (typeDist[d.type] || 0) + 1;
            });

            if (Object.keys(typeDist).length > 0) {
                const typeLabels = {
                    life_level: 'ç”Ÿå‘½çº§',
                    important: 'é‡è¦',
                    daily: 'æ—¥å¸¸'
                };
                const topType = Object.entries(typeDist).sort((a, b) => b[1] - a[1])[0][0];
                analysis.push(`**å†³ç­–ç±»å‹åå¥½**ï¼šæœ¬å‘¨æœ€å¸¸å¤„ç†çš„å†³ç­–ç±»å‹æ˜¯"${typeLabels[topType]}"ï¼ˆ${typeDist[topType]}ä¸ªï¼‰`);
            }

            // 2. æƒ…æ„Ÿå› ç´ åˆ†æ
            const avgEmotion = allDecisions.reduce((sum, d) => sum + (d.emotion_ratio || 0), 0) / allDecisions.length;
            const highEmotionCount = allDecisions.filter(d => (d.emotion_ratio || 0) > 0.5).length;

            if (avgEmotion > 0.5) {
                analysis.push(`**æƒ…æ„Ÿå½±å“è¾ƒé«˜**ï¼šå¹³å‡æƒ…æ„Ÿå æ¯”${(avgEmotion * 100).toFixed(0)}%ï¼Œæœ‰${highEmotionCount}ä¸ªå†³ç­–æƒ…æ„Ÿå› ç´ è¶…è¿‡50%ï¼Œå»ºè®®åœ¨é‡è¦å†³ç­–å‰å¢åŠ å†·é™æœŸ`);
            } else if (avgEmotion > 0.3) {
                analysis.push(`**æƒ…æ„Ÿå½±å“é€‚ä¸­**ï¼šå¹³å‡æƒ…æ„Ÿå æ¯”${(avgEmotion * 100).toFixed(0)}%ï¼Œæ³¨æ„å¹³è¡¡ç†æ€§ä¸æƒ…æ„Ÿ`);
            } else {
                analysis.push(`**ç†æ€§ä¸»å¯¼**ï¼šå¹³å‡æƒ…æ„Ÿå æ¯”${(avgEmotion * 100).toFixed(0)}%ï¼Œå†³ç­–è¾ƒä¸ºç†æ€§`);
            }

            // 3. é£é™©åˆ†æ
            const highRiskCount = allDecisions.filter(d => d.risk_level === 'high').length;
            if (highRiskCount > 0) {
                analysis.push(`**é«˜é£é™©å†³ç­–**ï¼šæœ¬å‘¨æœ‰${highRiskCount}ä¸ªé«˜é£é™©å†³ç­–ï¼Œè¯·ç¡®ä¿å®Œæˆæ‰€æœ‰å¿…è¦è¡ŒåŠ¨ï¼ˆå†·é™æœŸã€å’¨è¯¢ã€æ¨æ¼”ï¼‰`);
            }

            // 4. çŠ¶æ€åˆ†å¸ƒ
            const pendingCount = allDecisions.filter(d => d.outcome === 'pending').length;
            const inProgressCount = allDecisions.filter(d => d.outcome === 'in_progress').length;
            if (pendingCount + inProgressCount > 0) {
                analysis.push(`**å¾…å¤„ç†å†³ç­–**ï¼šæœ‰${pendingCount + inProgressCount}ä¸ªå†³ç­–å°šæœªå®Œæˆï¼ˆ${pendingCount}ä¸ªå¾…å¤„ç†ï¼Œ${inProgressCount}ä¸ªè¿›è¡Œä¸­ï¼‰`);
            }

            // 5. å¸¸è§æƒ…æ„Ÿå› ç´ 
            const emotionFactors = {};
            allDecisions.forEach(d => {
                (d.emotional_factors || []).forEach(factor => {
                    emotionFactors[factor] = (emotionFactors[factor] || 0) + 1;
                });
            });

            const topFactors = Object.entries(emotionFactors)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 3);

            if (topFactors.length > 0) {
                const factorsStr = topFactors.map(([f, c]) => `${f}(${c}æ¬¡)`).join('ã€');
                analysis.push(`**ä¸»è¦æƒ…æ„Ÿé©±åŠ¨**ï¼š${factorsStr}`);
            }

            container.innerHTML = analysis.length > 0
                ? analysis.map(point => `<div style="margin-bottom: 8px;">${point}</div>`).join('')
                : 'âœ… æœ¬å‘¨å†³ç­–æ¨¡å¼å¥åº·ï¼Œç»§ç»­ä¿æŒ';
        }

        // Update suggestions
        function updateSuggestions() {
            const container = document.getElementById('suggestions');
            if (!container) return;

            const suggestions = [];

            // åŸºäºæ•°æ®ç”Ÿæˆå»ºè®®
            const avgEmotion = allDecisions.length > 0
                ? allDecisions.reduce((sum, d) => sum + (d.emotion_ratio || 0), 0) / allDecisions.length
                : 0;

            const pendingCount = allDecisions.filter(d => d.outcome === 'pending').length;
            const inProgressCount = allDecisions.filter(d => d.outcome === 'in_progress').length;
            const highRiskInProgress = allDecisions.filter(d => d.risk_level === 'high' && d.outcome === 'in_progress').length;
            const lifeLevelCount = allDecisions.filter(d => d.type === 'life_level').length;

            // å»ºè®®ç”Ÿæˆé€»è¾‘
            if (avgEmotion > 0.5) {
                suggestions.push('ğŸ¯ **é™ä½æƒ…æ„Ÿå½±å“**ï¼šåœ¨é‡è¦å†³ç­–ä¸­ï¼Œå°è¯•å¢åŠ å†·é™æœŸæ—¶é—´ï¼Œå’¨è¯¢æ›´å¤šä¸“ä¸šäººå£«çš„æ„è§');
            }

            if (pendingCount > 3) {
                suggestions.push(`âš¡ **åŠ å¿«å†³ç­–è¿›åº¦**ï¼šæœ‰${pendingCount}ä¸ªå†³ç­–å¤„äºå¾…å¤„ç†çŠ¶æ€ï¼Œå»ºè®®ä¼˜å…ˆå¤„ç†é«˜ä¼˜å…ˆçº§äº‹é¡¹`);
            }

            if (highRiskInProgress > 0) {
                suggestions.push(`ğŸ”´ **é«˜é£é™©å†³ç­–ç®¡ç†**ï¼šæœ‰${highRiskInProgress}ä¸ªé«˜é£é™©å†³ç­–æ­£åœ¨è¿›è¡Œä¸­ï¼ŒåŠ¡å¿…å®Œæˆæ‰€æœ‰å¿…è¦è¡ŒåŠ¨ï¼ˆåˆ—å‡ºåå¯¹ç†ç”±ã€å’¨è¯¢3äººã€æœ€åæƒ…å†µæ¨æ¼”ã€7å¤©å†·é™æœŸï¼‰`);
            }

            if (lifeLevelCount === 0 && allDecisions.length > 5) {
                suggestions.push('ğŸ’­ **å†³ç­–è´¨é‡åæ€**ï¼šæœ¬å‘¨å†³ç­–æ•°é‡è¾ƒå¤šä½†ç¼ºå°‘ç”Ÿå‘½çº§å†³ç­–ï¼Œæ€è€ƒå“ªäº›å†³ç­–çœŸæ­£é‡è¦ï¼Ÿ');
            }

            const rejectedCount = allDecisions.filter(d => d.outcome === 'rejected').length;
            if (rejectedCount > allDecisions.length * 0.5 && allDecisions.length >= 3) {
                suggestions.push('ğŸ¤” **æ‹’ç»ç‡è¾ƒé«˜**ï¼šè¶…è¿‡ä¸€åŠçš„å†³ç­–è¢«æ‹’ç»ï¼Œå»ºè®®åœ¨å†³ç­–å‰æ›´æ·±å…¥åœ°è¯„ä¼°çœŸå®éœ€æ±‚ï¼Œé¿å…å†²åŠ¨å†³ç­–');
            }

            const completedCount = allDecisions.filter(d => d.outcome === 'completed').length;
            if (completedCount === 0 && allDecisions.length > 3) {
                suggestions.push('ğŸ **å®Œæˆå†³ç­–é—­ç¯**ï¼šè¿˜æ²¡æœ‰å®Œæˆçš„å†³ç­–ï¼Œå°è¯•å°†è‡³å°‘ä¸€ä¸ªå†³ç­–æ¨è¿›åˆ°å®ŒæˆçŠ¶æ€ï¼Œä»ä¸­å­¦ä¹ ç»éªŒ');
            }

            // é»˜è®¤å»ºè®®
            if (suggestions.length === 0) {
                suggestions.push('ğŸ“Š ç»§ç»­è®°å½•å†³ç­–ï¼Œç§¯ç´¯æ›´å¤šæ•°æ®åå°†è·å¾—æ›´ç²¾å‡†çš„ä¸ªæ€§åŒ–å»ºè®®');
                suggestions.push('ğŸ’¡ å°è¯•åœ¨å†³ç­–å‰è¿›è¡Œæ›´æ·±å…¥çš„åˆ†æï¼Œè®°å½•æ›´å¤šç†æ€§æ€è€ƒè¿‡ç¨‹');
            }

            container.innerHTML = suggestions.map(s => `<div style="margin-bottom: 12px;">${s}</div>`).join('');
        }

        // Export report as Markdown
        function exportReport() {
            const reportDate = new Date().toLocaleDateString('zh-CN');
            const weekNum = 'ç¬¬1å‘¨';

            let markdown = `# æˆé•¿å‘¨æŠ¥ - ${weekNum}\n\n`;
            markdown += `**æ—¥æœŸèŒƒå›´**ï¼š2026-02-02 è‡³ 2026-02-08  \n`;
            markdown += `**ç”Ÿæˆæ—¶é—´**ï¼š${reportDate}\n\n`;

            // ç»Ÿè®¡æ¦‚è§ˆ
            markdown += `## ğŸ“Š å†³ç­–è¿½è¸ªç»Ÿè®¡\n\n`;
            markdown += `- **æ€»å†³ç­–æ•°**ï¼š${allDecisions.length} ä¸ª\n`;
            markdown += `- **è¿›è¡Œä¸­**ï¼š${allDecisions.filter(d => d.outcome === 'in_progress').length} ä¸ª\n`;
            markdown += `- **å·²å®Œæˆ**ï¼š${allDecisions.filter(d => d.outcome === 'completed').length} ä¸ª\n`;
            markdown += `- **å¹³å‡æƒ…æ„Ÿå æ¯”**ï¼š${(allDecisions.reduce((sum, d) => sum + (d.emotion_ratio || 0), 0) / allDecisions.length * 100).toFixed(0)}%\n\n`;

            // å†³ç­–åˆ—è¡¨
            if (allDecisions.length > 0) {
                markdown += `## ğŸ“‹ å†³ç­–è¯¦æƒ…\n\n`;
                allDecisions.forEach((d, i) => {
                    const typeLabels = { life_level: 'ç”Ÿå‘½çº§', important: 'é‡è¦', daily: 'æ—¥å¸¸' };
                    const statusLabels = {
                        pending: 'â³ å¾…å¤„ç†',
                        in_progress: 'ğŸ”„ è¿›è¡Œä¸­',
                        accepted: 'âœ… å·²é‡‡çº³',
                        rejected: 'âŒ å·²æ‹’ç»',
                        completed: 'ğŸ å·²å®Œæˆ'
                    };

                    markdown += `### ${i + 1}. ${d.description}\n\n`;
                    markdown += `- **ID**ï¼š\`${d.decision_id}\`\n`;
                    markdown += `- **æ—¶é—´**ï¼š${new Date(d.timestamp).toLocaleString('zh-CN')}\n`;
                    markdown += `- **ç±»å‹**ï¼š${typeLabels[d.type]}\n`;
                    markdown += `- **é£é™©**ï¼š${d.risk_level.toUpperCase()}\n`;
                    if (d.emotional_factors && d.emotional_factors.length > 0) {
                        markdown += `- **æƒ…æ„Ÿå› ç´ **ï¼š${d.emotional_factors.join(', ')} (${(d.emotion_ratio * 100).toFixed(0)}%)\n`;
                    }
                    markdown += `- **çŠ¶æ€**ï¼š${statusLabels[d.outcome]}\n`;
                    if (d.rational_analysis) {
                        markdown += `- **ç†æ€§åˆ†æ**ï¼š${d.rational_analysis}\n`;
                    }
                    markdown += `\n`;
                });
            }

            // ä¸‹è½½æ–‡ä»¶
            const blob = new Blob([markdown], { type: 'text/markdown;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `growth-report-${weekNum}-${new Date().toISOString().split('T')[0]}.md`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Get status text in Chinese
        function getStatusText(status) {
            const texts = {
                pending: 'å¾…å¤„ç†',
                in_progress: 'è¿›è¡Œä¸­',
                accepted: 'å·²é‡‡çº³',
                rejected: 'å·²æ‹’ç»',
                completed: 'å·²å®Œæˆ'
            };
            return texts[status] || status;
        }

        // Create decision
        async function createDecision() {
            const description = document.getElementById('create-description').value.trim();
            const type = document.getElementById('create-type').value;
            const rational = document.getElementById('create-rational').value.trim();
            const emotions = document.getElementById('create-emotions').value.split(',').map(e => e.trim()).filter(e => e);

            if (!description) {
                alert('è¯·è¾“å…¥å†³ç­–æè¿°');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/decisions`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        description,
                        type,
                        rational_analysis: rational,
                        emotional_factors: emotions
                    })
                });

                const result = await response.json();

                if (result.success) {
                    closeCreateModal();
                    loadData();
                    alert('å†³ç­–åˆ›å»ºæˆåŠŸï¼');
                } else {
                    alert('åˆ›å»ºå¤±è´¥ï¼š' + result.error);
                }
            } catch (error) {
                alert('ç½‘ç»œé”™è¯¯ï¼š' + error.message);
            }
        }

        // Update status
        async function updateStatus() {
            const decisionId = document.getElementById('update-decision-id').value;
            const newStatus = document.getElementById('update-status').value;
            const note = document.getElementById('update-note').value.trim();

            try {
                const response = await fetch(`${API_BASE}/decisions/${decisionId}/status`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        status: newStatus,
                        note: note
                    })
                });

                const result = await response.json();

                if (result.success) {
                    closeUpdateModal();
                    loadData();
                    alert('çŠ¶æ€æ›´æ–°æˆåŠŸï¼');
                } else {
                    alert('æ›´æ–°å¤±è´¥ï¼š' + result.error);
                }
            } catch (error) {
                alert('ç½‘ç»œé”™è¯¯ï¼š' + error.message);
            }
        }

        // Modal functions
        function openCreateModal() {
            document.getElementById('createModal').classList.add('active');
        }

        function closeCreateModal() {
            document.getElementById('createModal').classList.remove('active');
            document.getElementById('createForm').reset();
        }

        function openUpdateModal(decisionId, currentStatus) {
            document.getElementById('update-decision-id').value = decisionId;
            document.getElementById('current-status-badge').textContent = getStatusText(currentStatus);
            document.getElementById('current-status-badge').className = `status-badge ${currentStatus}`;
            document.getElementById('update-status').value = currentStatus;
            document.getElementById('updateModal').classList.add('active');
        }

        function closeUpdateModal() {
            document.getElementById('updateModal').classList.remove('active');
            document.getElementById('updateForm').reset();
        }

        function viewDetails(decisionId) {
            const decision = allDecisions.find(d => d.decision_id === decisionId);
            if (!decision) {
                alert('æœªæ‰¾åˆ°å†³ç­–ä¿¡æ¯');
                return;
            }

            const typeLabels = {
                'life_level': 'ç”Ÿå‘½çº§',
                'important': 'é‡è¦',
                'daily': 'æ—¥å¸¸'
            };

            const statusLabels = {
                'pending': 'â³ å¾…å¤„ç†',
                'in_progress': 'ğŸ”„ è¿›è¡Œä¸­',
                'accepted': 'âœ… å·²é‡‡çº³',
                'rejected': 'âŒ å·²æ‹’ç»',
                'completed': 'ğŸ å·²å®Œæˆ'
            };

            const riskEmojis = {
                'high': 'ğŸ”´',
                'medium': 'ğŸŸ¡',
                'low': 'ğŸŸ¢'
            };

            let html = `
                <div style="margin-bottom: 24px;">
                    <h3 style="font-size: 20px; margin-bottom: 12px; color: #1E3A8A;">${decision.description}</h3>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px;">
                        <span class="status-badge" style="background: #E0F2FE; color: #0369A1;">${decision.decision_id}</span>
                        <span class="status-badge" style="background: #DBEAFE; color: #1E40AF;">${typeLabels[decision.type]}</span>
                        <span class="status-badge">${riskEmojis[decision.risk_level] || 'âšª'} ${decision.risk_level.toUpperCase()}</span>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="font-weight: 600; color: #475569; display: block; margin-bottom: 8px;">ğŸ“… æ—¶é—´</label>
                    <div style="color: #64748B;">${new Date(decision.timestamp).toLocaleString('zh-CN')}</div>
                </div>

                ${decision.rational_analysis ? `
                <div style="margin-bottom: 20px;">
                    <label style="font-weight: 600; color: #475569; display: block; margin-bottom: 8px;">ğŸ§  ç†æ€§åˆ†æ</label>
                    <div style="background: #F1F5F9; padding: 12px; border-radius: 8px; color: #334155; line-height: 1.6;">${decision.rational_analysis}</div>
                </div>
                ` : ''}

                ${decision.emotional_factors && decision.emotional_factors.length > 0 ? `
                <div style="margin-bottom: 20px;">
                    <label style="font-weight: 600; color: #475569; display: block; margin-bottom: 8px;">â¤ï¸ æƒ…æ„Ÿå› ç´  (${Math.round((decision.emotion_ratio || 0) * 100)}%)</label>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        ${decision.emotional_factors.map(factor => `<span style="background: #FEE2E2; color: #991B1B; padding: 4px 12px; border-radius: 6px; font-size: 13px;">${factor}</span>`).join('')}
                    </div>
                </div>
                ` : ''}

                ${decision.ai_warning ? `
                <div style="margin-bottom: 20px;">
                    <label style="font-weight: 600; color: #475569; display: block; margin-bottom: 8px;">âš ï¸ AIè­¦å‘Š</label>
                    <div style="background: #FEF3C7; border-left: 3px solid #F59E0B; padding: 12px; border-radius: 8px; color: #92400E;">${decision.ai_warning}</div>
                </div>
                ` : ''}

                ${decision.required_actions && decision.required_actions.length > 0 ? `
                <div style="margin-bottom: 20px;">
                    <label style="font-weight: 600; color: #475569; display: block; margin-bottom: 8px;">ğŸ“‹ å¿…è¦è¡ŒåŠ¨æ¸…å•</label>
                    <ul style="list-style: none; padding: 0;">
                        ${decision.required_actions.map(action => `
                            <li style="padding: 8px 0; border-bottom: 1px solid #E2E8F0; color: #475569;">
                                <span style="color: #94A3B8; margin-right: 8px;">â€¢</span>${action}
                            </li>
                        `).join('')}
                    </ul>
                </div>
                ` : ''}

                <div style="margin-bottom: 20px;">
                    <label style="font-weight: 600; color: #475569; display: block; margin-bottom: 8px;">ğŸ“Š å½“å‰çŠ¶æ€</label>
                    <div class="status-badge ${decision.outcome}" style="display: inline-block;">${statusLabels[decision.outcome] || decision.outcome}</div>
                </div>

                ${decision.status_history && decision.status_history.length > 0 ? `
                <div style="margin-bottom: 20px;">
                    <label style="font-weight: 600; color: #475569; display: block; margin-bottom: 8px;">ğŸ“œ çŠ¶æ€å†å²</label>
                    ${decision.status_history.map(history => `
                        <div style="padding: 12px; background: #F8FAFC; border-radius: 8px; margin-bottom: 8px;">
                            <div style="font-size: 12px; color: #94A3B8; margin-bottom: 4px;">${new Date(history.timestamp).toLocaleString('zh-CN')}</div>
                            <div style="color: #475569;">
                                <span class="status-badge" style="background: #E2E8F0; color: #64748B; font-size: 11px;">${statusLabels[history.from_status] || history.from_status}</span>
                                <span style="margin: 0 8px; color: #94A3B8;">â†’</span>
                                <span class="status-badge" style="background: #DBEAFE; color: #1E40AF; font-size: 11px;">${statusLabels[history.to_status] || history.to_status}</span>
                            </div>
                            ${history.note ? `<div style="margin-top: 8px; color: #64748B; font-size: 13px;">ğŸ’¬ ${history.note}</div>` : ''}
                        </div>
                    `).join('')}
                </div>
                ` : ''}
            `;

            document.getElementById('details-content').innerHTML = html;
            document.getElementById('detailsModal').classList.add('active');
        }

        function closeDetailsModal() {
            document.getElementById('detailsModal').classList.remove('active');
        }

        function toggleAction(checkbox) {
            checkbox.classList.toggle('checked');

            // Update progress
            const section = checkbox.closest('.required-actions');
            const checkboxes = section.querySelectorAll('.action-checkbox');
            const checked = section.querySelectorAll('.action-checkbox.checked');
            const progress = (checked.length / checkboxes.length) * 100;

            section.querySelector('.progress-text').textContent = Math.round(progress) + '%';
            section.querySelector('.progress-fill').style.width = progress + '%';
        }

        function showError(message) {
            const container = document.getElementById('decision-list');
            container.innerHTML = `
                <div class="error">
                    âš ï¸ ${message}
                </div>
            `;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });
    </script>
</body>
</html>
